(function(){var addTexture,animate,camera,clock,container,controls,currentTexture,effect,fullscreen,init,isFullScreen,mesh,render,renderer,resize,scene,showNextTexture,stereoSeparation,textureIndex,update,videoTexture;container=void 0,scene=void 0,camera=void 0,renderer=void 0,controls=void 0,effect=void 0,clock=new THREE.Clock,mesh=void 0,videoTexture=void 0,textureIndex=-1,currentTexture=void 0,window.textures=["texture/texture.jpg"],window.viewer_mode="single",window.allowStereo=!1,window.useCanvasRenderer=!1,window.fixed_viewer=!1,stereoSeparation=-6.2,init=function(){var ASPECT,FAR,NEAR,SCREEN_HEIGHT,SCREEN_WIDTH,VIEW_ANGLE,element,setOrientationControls;setOrientationControls=function(e){e.alpha&&(controls=new THREE.DeviceOrientationControls(camera,!0),controls.connect(),controls.update(),element.addEventListener("click",fullscreen,!1),window.removeEventListener("deviceorientation",setOrientationControls,!0))},scene=new THREE.Scene,SCREEN_WIDTH=window.innerWidth,SCREEN_HEIGHT=window.innerHeight,VIEW_ANGLE=90,ASPECT=SCREEN_WIDTH/SCREEN_HEIGHT,NEAR=.001,FAR=2e3,Detector.webgl?renderer=new THREE.WebGLRenderer({antialias:!0}):window.forceWebGL?($("#alert").show(),$("body").addClass("disabled")):(window.useCanvasRenderer=!0,renderer=new THREE.CanvasRenderer),element=renderer.domElement,"stereo"===window.viewer_mode&&(effect=new THREE.StereoEffect(renderer),effect.separation=stereoSeparation,effect.setSize(SCREEN_WIDTH,SCREEN_HEIGHT)),camera=new THREE.PerspectiveCamera(VIEW_ANGLE,ASPECT,NEAR,FAR),scene.add(camera),camera.position.set(0,10,0),renderer.setSize(SCREEN_WIDTH,SCREEN_HEIGHT),container=document.getElementById("viewer360"),container.appendChild(renderer.domElement),controls=new THREE.OrbitControls(camera,element),controls.rotateUp(Math.PI/6),controls.target.set(camera.position.x+.1,camera.position.y,camera.position.z),controls.noZoom=!0,controls.noPan=!0,window.fixed_viewer===!0&&(controls.minPolarAngle=Math.PI/2,controls.maxPolarAngle=Math.PI/2),window.addEventListener("deviceorientation",setOrientationControls,!0),showNextTexture(),window.addEventListener("resize",resize,!1),setTimeout(resize,1)},animate=function(){requestAnimationFrame(animate),render(),update()},addTexture=function(idx){var geometry,material;currentTexture&&(scene.remove(currentTexture),videoTexture&&(videoTexture.destroy(),videoTexture=null)),window.textures[idx].indexOf(".jpg")>-1||window.textures[idx].indexOf(".png")>-1?(material=new THREE.MeshBasicMaterial({map:THREE.ImageUtils.loadTexture(window.textures[idx])}),window.useCanvasRenderer&&(material.overdraw=.5),currentTexture=new THREE.Mesh(new THREE.SphereGeometry(100,32,32),material)):window.textures[idx].indexOf(".mp4")>-1&&(videoTexture=new THREEx.VideoTexture(window.textures[idx]),geometry=new THREE.SphereGeometry(100,32,32),material=new THREE.MeshBasicMaterial({map:videoTexture.texture}),currentTexture=new THREE.Mesh(geometry,material),currentTexture.material.side=THREE.DoubleSide),currentTexture.scale.x=-1,scene.add(currentTexture)},showNextTexture=function(){textureIndex+=1,textureIndex>=window.textures.length&&(textureIndex=0),addTexture(textureIndex)},update=function(delta,now){delta=clock.getDelta(),null!=videoTexture&&videoTexture.update(),controls.update()},render=function(){"stereo"===window.viewer_mode?effect.render(scene,camera):renderer.render(scene,camera)},resize=function(){var height,width;width=container.offsetWidth,height=container.offsetHeight,camera.aspect=width/height,camera.updateProjectionMatrix(),"stereo"===window.viewer_mode?effect.setSize(width,height):renderer.setSize(width,height)},isFullScreen=function(){var fsElem;return fsElem=document.fullscreenElement||document.msFullscreenElement||document.mozFullscreenElement||document.webkitFullscreenElement,null!==fsElem&&void 0!==fsElem},fullscreen=function(){container.requestFullscreen?container.requestFullscreen():container.msRequestFullscreen?container.msRequestFullscreen():container.mozRequestFullScreen?container.mozRequestFullScreen():container.webkitRequestFullscreen&&container.webkitRequestFullscreen()},window.nextTexture=function(){return showNextTexture()},window.showFullScreen=function(){return isFullScreen()?void 0:fullscreen()},$(function(){return window.forceStereo&&(window.viewer_mode="stereo"),init(),animate()})}).call(this);
